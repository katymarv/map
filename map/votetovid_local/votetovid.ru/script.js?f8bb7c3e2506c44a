var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,c){a.raw=c;return a};$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var c,k=[];!(c=a.next()).done;)k.push(c.value);return k};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.checkStringArgs=function(a,c,k){if(null==a)throw new TypeError("The 'this' value for String.prototype."+k+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+k+" must not be a regular expression");return a+""};
$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,k){a!=Array.prototype&&a!=Object.prototype&&(a[c]=k.value)};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var c=0;c<a.length;++c){var k=a[c];if(k&&k.Math==Math)return k}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,c,k,t){if(c){k=$jscomp.global;a=a.split(".");for(t=0;t<a.length-1;t++){var m=a[t];m in k||(k[m]={});k=k[m]}a=a[a.length-1];t=k[a];c=c(t);c!=t&&null!=c&&$jscomp.defineProperty(k,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,k){var c=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var m=c.length,z=a.length;k=Math.max(0,Math.min(k|0,c.length));for(var q=0;q<z&&k<m;)if(c[k++]!=a[q++])return!1;return q>=z}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function c(){this.batch_=null}function k(a){return a instanceof m?a:new m(function(q,c){q(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;c.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var q=this;this.asyncExecuteFunction(function(){q.executeBatch_()})}this.batch_.push(a)};var t=$jscomp.global.setTimeout;c.prototype.asyncExecuteFunction=function(a){t(a,0)};c.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var c=0;c<a.length;++c){var k=a[c];a[c]=null;try{k()}catch(B){this.asyncThrow_(B)}}}this.batch_=null};c.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var m=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var q=this.createResolveAndReject_();try{a(q.resolve,q.reject)}catch(x){q.reject(x)}};m.prototype.createResolveAndReject_=function(){function a(a){return function(q){k||(k=!0,a.call(c,q))}}var c=this,k=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};m.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof m)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};m.prototype.resolveToNonPromiseObj_=function(a){var c=void 0;try{c=a.then}catch(x){this.reject_(x);return}"function"==typeof c?
this.settleSameAsThenable_(c,a):this.fulfill_(a)};m.prototype.reject_=function(a){this.settle_(2,a)};m.prototype.fulfill_=function(a){this.settle_(1,a)};m.prototype.settle_=function(a,c){if(0!=this.state_)throw Error("Cannot settle("+a+", "+c+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=c;this.executeOnSettledCallbacks_()};m.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)z.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var z=new c;m.prototype.settleSameAsPromise_=function(a){var c=this.createResolveAndReject_();a.callWhenSettled_(c.resolve,c.reject)};m.prototype.settleSameAsThenable_=function(a,c){var k=this.createResolveAndReject_();try{a.call(c,k.resolve,k.reject)}catch(B){k.reject(B)}};m.prototype.then=function(a,c){function k(a,c){return"function"==typeof a?function(c){try{q(a(c))}catch(C){t(C)}}:c}var q,t,K=new m(function(a,c){q=a;t=c});this.callWhenSettled_(k(a,q),k(c,t));return K};
m.prototype.catch=function(a){return this.then(void 0,a)};m.prototype.callWhenSettled_=function(a,c){function k(){switch(m.state_){case 1:a(m.result_);break;case 2:c(m.result_);break;default:throw Error("Unexpected state: "+m.state_);}}var m=this;null==this.onSettledCallbacks_?z.asyncExecute(k):this.onSettledCallbacks_.push(k)};m.resolve=k;m.reject=function(a){return new m(function(c,k){k(a)})};m.race=function(a){return new m(function(c,m){for(var q=$jscomp.makeIterator(a),t=q.next();!t.done;t=q.next())k(t.value).callWhenSettled_(c,
m)})};m.all=function(a){var c=$jscomp.makeIterator(a),q=c.next();return q.done?k([]):new m(function(a,m){function t(c){return function(k){v[c]=k;u--;0==u&&a(v)}}var v=[],u=0;do v.push(void 0),u++,k(q.value).callWhenSettled_(t(v.length-1),m),q=c.next();while(!q.done)})};return m},"es6","es3");
$jscomp.polyfill("Promise.prototype.finally",function(a){return a?a:function(a){return this.then(function(c){return Promise.resolve(a()).then(function(){return c})},function(c){return Promise.resolve(a()).then(function(){throw c;})})}},"es9","es3");Function.prototype.debounce=function(a){var c=this,k;return function(){var t=arguments,m=this;window.clearTimeout(k);k=setTimeout(function(){c.apply(m,t)},a)}};
Function.prototype.throttle=function(a){var c=this,k,t;return function z(){var q=this;k?t=arguments:(c.apply(q,arguments),k=setTimeout(function(){k=!1;t&&(z.apply(q,t),t=void 0)},a))}};
(function(){function a(){if(a.enabled){var d=u.map(function(b){return b()}).filter(Boolean).join(",");window.history.replaceState({},"","#"+d)}}function c(d){return d.map(function(b){return{lat:Math.round(1E5*b.lat),lng:Math.round(1E5*b.lng)}}).reduce(function(b,d,a,g){a=a?g[a-1]:{lat:0,lng:0};return b.concat([d.lat-a.lat,d.lng-a.lng])},[]).map(function(b){var d="";b<<=1;b^=0>b?-1:0;do{var a=String.fromCharCode((b&31|(31<b?32:0))+63),g="[]{}^\\`|@~".indexOf(a);d+=0>g?a:g;b>>=5}while(b);return d}).join("")}
function k(d){for(var b=[],a=0,n=0,g=0,e;a<d.length;a++)e=d.charCodeAt(a),48<=e&&57>=e&&(e="[]{}^\\`|@~".charCodeAt(e-48)),e-=63,n|=(e&31)<<g,g+=5,32>e&&(n^=n&1?-1:0,n>>=1,n/=1E5,b.push(n),g=n=0);return b.reduce(function(b,e,d,a){var f=b.length?b[b.length-1]:{lat:0,lng:0};d&1&&b.push(L.latLng(f.lat+a[d-1],f.lng+e));return b},[])}function t(d){if(0<d){var b=d%52+65;90<b&&(b+=6);return t(Math.floor(d/52))+String.fromCharCode(b)}return""}function m(d){for(var b=0,a=0;a<d.length;a++){var n=d.charCodeAt(a);
n-=96<n?71:65;b=52*b+n}return b}function z(d){var b=0>d.lat?"S":"N";var a=Math.abs(d.lat);b+=Math.floor(a)+"\u00b0";b+=(60*(a-Math.floor(a))).toPrecision(4)+"' ";a=(d.lng%360+540)%360-180;b+=0>a?"W":"E";a=Math.abs(a);b+=Math.floor(a)+"\u00b0";return b+=(60*(a-Math.floor(a))).toPrecision(4)+"'"}function q(d,b,a){if(Array.isArray(d)&&void 0===a){if(0==d.length)return null;if(1==d.length)return d[0];a=K(Math.floor(b),0,d.length-2);b-=a;return d[a]*(1-b)+d[a+1]*b}return d*(1-a)+b*a}function K(a,b,l){return a<=
b?b:a>=l?l:a}function x(a){return Math.round(a).toLocaleString()+i18n.meterSuffix}function B(a,b){return Math.atan2(Math.sin(b.lng-a.lng)*Math.cos(b.lat),Math.cos(a.lat)*Math.sin(b.lat)-Math.sin(a.lat)*Math.cos(b.lat)*Math.cos(b.lng-a.lng))}function O(a,b){var d=Math.sin((b.lat-a.lat)/2),n=Math.sin((b.lng-a.lng)/2);a=d*d+Math.cos(a.lat)*Math.cos(b.lat)*n*n;return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function N(a,b,l,n){void 0===n&&(n=O(a,b));if(0==n)return a;var d=Math.sin((1-l)*n)/Math.sin(n);
l=Math.sin(l*n)/Math.sin(n);n=d*Math.cos(a.lat)*Math.cos(a.lng)+l*Math.cos(b.lat)*Math.cos(b.lng);var e=d*Math.cos(a.lat)*Math.sin(a.lng)+l*Math.cos(b.lat)*Math.sin(b.lng);return new D(Math.atan2(d*Math.sin(a.lat)+l*Math.sin(b.lat),Math.sqrt(n*n+e*e)),Math.atan2(e,n))}var v=Math.PI/180,u=[],y=[];window.onhashchange=function(){a.enabled=!1;var d=window.location.hash;y.forEach(function(b){return b(d)});a.enabled=!0};a.enabled=!0;var C=[],P=[],r={};Element.prototype.q=function(a){return this.querySelector('[data-key="'+
a+'"]')||document.createElement("div")};Element.prototype.qev=function(a,b,l){for(var d in b){var g=b[d];void 0!==l&&(g=g.bind(null,l));L.DomEvent.on(this.q(d),a,g)}};var D=function(a,b){a instanceof L.LatLng?(this.lat=a.lat*v,this.lng=a.lng*v):a instanceof D?(this.lat=a.lat,this.lng=a.lng):(this.lat=a,this.lng=b)};D.prototype.toDeg=function(){return L.latLng(this.lat/v,this.lng/v)};D.prototype.wrapTo=function(a){for(var b=new D(this,void 0);b.lng-a.lng>Math.PI;)b.lng-=2*Math.PI;for(;a.lng-b.lng>
Math.PI;)b.lng+=2*Math.PI;return b};L.LatLng.prototype.toUrlValue=function(){return this.lat.toFixed(6)+","+this.lng.toFixed(6)};L.LatLng.prototype.latR=function(){return this.lat*Math.PI/180};L.LatLng.prototype.lngR=function(){return this.lng*Math.PI/180};L.LatLng.prototype.toRad=function(){return new D(this,void 0)};L.Control.BtnGroup=L.Control.extend({onAdd:function(a){var b=L.DomUtil.create("div","btnGroup");b.id=this.options.id;this.options.className&&b.classList.add(this.options.className);
this.options.buttons.forEach(function(a){var d=L.DomUtil.create("div","btn");d.group=b;a(d);b.appendChild(d)});L.DomEvent.disableClickPropagation(b);return b}});L.control.btnGroup=function(a){return new L.Control.BtnGroup(a)};L.Polyline.include({_projectLatlngs:function(a,b,l){if(a[0]instanceof L.LatLng){for(var d=[],g=1;g<a.length;g++){var e=$jscomp.makeIterator([a[g-1].toRad(),a[g].toRad()]),c=e.next().value;e=e.next().value;for(var f=O(c,e),k=6371E3*f/1E4,U=0,p=0;1>p;p+=Math.cos(c.lat)/Math.sqrt(k)){for(var E=
N(c,e,p,f);E.lng<c.lng-Math.PI&&E.lng<e.lng-Math.PI;)E.lng+=2*Math.PI;for(;E.lng>c.lng+Math.PI&&E.lng>e.lng+Math.PI;)E.lng-=2*Math.PI;d.push(h.latLngToLayerPoint(E.toDeg()));l.extend(d[d.length-1]);U++}}d.push(h.latLngToLayerPoint(a[a.length-1]));l.extend(d[d.length-1]);b.push(d)}else for(d=0;d<a.length;d++)this._projectLatlngs(a[d],b,l)}});L.Editable.MiddleMarker.include({computeLatLng:function(){var a=this.left.latlng.toRad(),b=this.right.latlng.toRad();return N(a,b,.5).wrapTo(a).toDeg()}});L.Editable.PathEditor.include({onDrawingMouseMove:function(a){return function(b){if(this._drawing&&
this._drawnLatLngs.length){var d=this._drawnLatLngs[this._drawing==L.Editable.FORWARD?this._drawnLatLngs.length-1:0];179.999<b.latlng.lng-d.lng&&(b.latlng.lng=d.lng+179.999);179.999<d.lng-b.latlng.lng&&(b.latlng.lng=d.lng-179.999)}a.call(this,b)}}(L.Editable.PathEditor.prototype.onDrawingMouseMove)});(function(){L.DomUtil.get("helpBtn").onclick=function(a){L.DomUtil.get("help").className="slide-in";ga("send","event","HelpW","Open")};L.DomUtil.get("helpCloseBtn").onclick=function(){L.DomUtil.get("help").className=
"slide-out";ga("send","event","HelpW","Close")}})();var h=function(){var d=i18n.initLL,b=i18n.initZoom,l=document.getElementById("map"),c=window.location.hash.match(/[#,](-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?),(\d+)z/);c&&(d.lat=parseFloat(c[1]),d.lng=parseFloat(c[2]),b=parseInt(c[3],10));var g=L.map(l,{zoom:b,center:d,zoomControl:!1,editable:!0,editOptions:{lineGuideOptions:{color:"#f00"}}});g.vMode=!1;g.setvMode=function(b){""!=g.vMode&&g.getContainer().classList.remove(g.vMode);b&&g.getContainer().classList.add(b);
g.vMode=b};g.tglvMode=function(b){g.setvMode(b==g.vMode?!1:b)};L.DomEvent.on(document,"keydown",function(b){27==b.keyCode&&g.vMode&&(g.setvMode(!1),L.DomEvent.stop(b))}.bind(this));u.push(function(){var b=g.getCenter(),a=g.getZoom(),f=Math.max(0,Math.ceil(Math.log(a)/Math.LN2));return b.lat.toFixed(f)+","+b.lng.toFixed(f)+","+a+"z"});y.push(function(b){(b=b.match(/[#,](-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?),(\d+)z(?=,|$)/))&&g.setView({lat:parseFloat(b[1]),lng:parseFloat(b[2])},parseInt(b[3],10))});g.on("moveend",
a.debounce(300));L.control.zoom({position:"bottomright"}).addTo(g);return g}();(function(){h.on({click:function(a){for(var b=C.length;0<b--&&!C[b](a););},contextmenu:function(a){for(var b=P.length;0<b--&&!P[b](a););}})})();(function(){var d=L.popup({className:"infoW"}),b=L.DomUtil.create("div");d.setContent(b);d.on({add:a,remove:a});h.on("v:infow-invalidate",function(){return d.remove()});u.push(function(){return d.isOpen()?d.getLatLng().toUrlValue()+"i":""});y.push(function(b){(b=b.match(/[#,](-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?)i(?=,|$)/))?
h.fire("click",{latlng:L.latLng(parseFloat(b[1]),parseFloat(b[2])),noRecurse:!0}):h.closePopup(d)});C.push(function(a){function c(b,a,e){b=h.wrapLatLng(b);var f=Math.round(1200*b.lat),d=Math.round(1200*b.lng),g=7500*(Math.floor((f+12E5)%1200/50)+24*Math.floor((d+12E5)%1200/50));g=fetch("/t/v/"+a+"/a/"+(Math.floor(f/1200)+"/"+Math.floor(d/1200)),{headers:{Range:"bytes="+g+"-"+(g+7499)}}).then(function(b){return b.arrayBuffer().then(function(a){return{data:a,status:b.status}})}).then(function(b){var a=
b.data,e=0,g=0,l=83;a&&(a=new Uint8Array(a),e=1.5*a[(f+12E5)%50*50+(d+12E5)%50]%360,g=a[2500+(f+12E5)%50*50+(d+12E5)%50],l=a[5E3+(f+12E5)%50*50+(d+12E5)%50]-7);if(404===b.status||e!==e)e=0,g=136,l=83;return{az:e,elev:l,ll:new L.latLng((f+(g>>4)-8)/1200,(d+(g&15)-8)/1200)}});if(e)return{llP:Promise.resolve(b),azP:g.then(function(b){return b.az}),elevP:g.then(function(b){return b.elev})};e=g.then(function(b){return c(b.ll,a,!0)});return{llP:e.then(function(b){return b.llP}),azP:e.then(function(b){return b.azP}),
elevP:e.then(function(b){return b.elevP})}}h.getContainer().classList.add("progress");var g=window.location.hash.match(/[#,](\d+)(v(30|90|180|360)|s)l/),e=g?parseInt(g[3],10):0;g=g?parseInt(g[1],10)/100:0;var l=c(a.latlng,e,a.noRecurse||a.originalEvent.ctrlKey||!e||.1>g);a=l.llP;g=l.azP;l=l.elevP;var f=a.then(function(b){return fetch("/hgt/"+b.toUrlValue()+"/").then(function(b){return b.json().then(function(a){return b.ok?+a:-9999})})});a.then(function(a){b.innerHTML='<div data-key="data"><b>'+(z(a)+
"</b><br>")+(i18n.iWheight+': <span data-key="txHgt">?</span><br></div><ul data-key="menu" class="menu"></ul><div data-key="links"><a data-key="lnkGE" target="_blank">3D (Google Earth)</a><a data-key="lnkPkF" target="_blank">PeakFinder</a></div><hr><div id="ya-share"></div>');d.setLatLng(a);d.openOn(h);h.getContainer().classList.remove("progress");h.fire("v:infow",{ll:a,popup:d,popwrap:b});new Ya.share2("ya-share",{content:{url:window.location},theme:{counter:!0,services:i18n.yaShareServices,size:"s"},
hooks:{onshare:function(b){ga("send","event","Map","Share",b)}}})});f.then(function(a){var e=b.q("txHgt");-9999<a?(e.textContent=x(a),e.style.fontWeight=700):e.textContent=i18n.unavailable;d.update()});Promise.all([a,f,e,g,l]).then(function(a){var e=$jscomp.makeIterator(a);a=e.next().value;var f=e.next().value,g=e.next().value,l=e.next().value;e=e.next().value;b.q("lnkGE").href="https://earth.google.com/web/@"+a.toUrlValue()+","+(f+10)+"a,0d,"+(90>g?35:60)+"y,"+l+"h,"+e+"t,0r";d.update()});Promise.all([a,
g]).then(function(a){var e=$jscomp.makeIterator(a);a=e.next().value;e=e.next().value;b.q("lnkPkF").href="https://www.peakfinder.org/?lat="+a.lat+"&lng="+a.lng+"&azi="+e;d.update()})})})();(function(){L.Control.LGroup=L.Control.extend({onAdd:function(d){var b=L.DomUtil.create("div","btnGroup"),l=this.options.layers,c=this.options.opCtl,g,e;this.options.tooltip&&(b.title=this.options.tooltip);u.push(function(){if(e)return(c?Math.round(100*e.options.opacity):"")+e.options.hashId});L.DomEvent.on(document,
"keydown",function(b){"INPUT"!==b.target.nodeName&&b.keyCode===this.options.flipKeyCode&&(L.DomEvent.stop(b),(g||e&&l[l.length-(e.options.lIndex+1)]||l[0]).btn.click())}.bind(this));var h=function(b){e&&c&&(b=e.options.opacity+(0<b?-.1:.1),e.setOpacity(0>b?0:1<b?1:b),a())};L.DomEvent.on(b,"wheel",function(b){L.DomEvent.stop(b);h(b.deltaY)});c&&document.addEventListener("wheel",function(b){b.ctrlKey&&(L.DomEvent.stop(b),h(b.deltaY))},{passive:!1,capture:!0});l.forEach(function(f,l){f.options.lIndex=
l;var h=L.DomUtil.create("div","btn",b);f.btn=h;h.innerHTML=f.options.title;h.onclick=function(b){e===f?c&&(b=e.options.opacity+.25,e.setOpacity(1<b?0:b)):(e&&(e.remove(),e.btn.className="btn",g=e),e=f,e.addTo(d),e.btn.className+=" cur",c&&g&&e.setOpacity(Math.max(g.options.opacity,.25)));a()};y.push(function(b){if(b=b.match((c?"[#,](\\d+)":"[#,]")+f.options.hashId+"(?=,|$)"))h.click(),c&&e.setOpacity(parseInt(b[1],10)/100)});f.options.hashId===i18n.initBase&&window.setTimeout(function(){e||h.click()},
1)});L.DomEvent.disableClickPropagation(b);return b}});L.control.lGroup=function(a){return new L.Control.LGroup(a)};L.control.lGroup({position:"topleft",flipKeyCode:9,layers:[L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",title:i18n.btnBsatText,maxNativeZoom:17,hashId:"sb"}),L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",
{attribution:'map data: \u00a9 <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | map style: \u00a9 <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',title:i18n.btnBtopoText,maxNativeZoom:17,hashId:"tb"})]}).addTo(h);L.control.lGroup({position:"topleft",flipKeyCode:32,opCtl:!0,tooltip:i18n.switchOverlayTooltip,layers:[30,90,180,360].map(function(a){return L.tileLayer("/t/v/{tilepath}",
{title:(30===a?i18n.btnLvText+" ":"")+a+"\u00b0",maxNativeZoom:11,opacity:.5,zIndex:2,hashId:"v"+a+"l",tilepath:function(b){return[a,"/z",b.z,"/",b.x>>10,"/x",b.x,"/",b.y>>10,"/y",b.y,".jpg"].join("")},isDefault:30===a})}).concat(L.tileLayer("/t/s/{tilepath}",{title:i18n.btnLsText,maxNativeZoom:13,opacity:.51,zIndex:2,hashId:"sl",tilepath:function(a){return["z",a.z,"/",a.x>>10,"/x",a.x,"/",a.y>>10,"/y",a.y,".jpg"].join("")}}))}).addTo(h)})();(function(){var a={obsAh:{def:2,hashkey:"ah"},obsBh:{def:0,
hashkey:"bh"},maxRng:{def:!1,hashkey:"lr"},imperial:{def:!1,hashkey:"iu"},rfrMode:{def:0,hashkey:"rm"},rfrRadius:{def:1.33,hashkey:"rr"},rfrTemp:{def:15,hashkey:"rt"}};u.push(function(){var b=[],d;for(d in a)if(r[d]!==a[d].def)switch(typeof a[d].def){case "number":b.push(""+a[d].hashkey+r[d]);break;case "boolean":b.push(a[d].hashkey)}return 0==b.length?"":b.join("!")+"s"});y.push(function(b){for(var d in a)r[d]=a[d].def;(b=b.match(/[#,]([^,]+)s(?=,|$)/))&&b[1].split("!").forEach(function(b){for(var d in a)if(b.startsWith(a[d].hashkey))switch(typeof a[d].def){case "number":r[d]=
parseFloat(b.slice(a[d].hashkey.length));break;case "boolean":r[d]=!0}});h.fire("v:settings")})})();(function(){function d(){}var b=(new L.Polyline([],{color:"#f00",interactive:!1})).addTo(h),l=[],n=!0;C.push(function(a){if(b.editEnabled())return!0});L.control.btnGroup({position:"topleft",id:"trkGroup",className:"closed",buttons:[function(d){d.innerHTML=i18n.btnTrackText;d.title=i18n.btnTrackTooltip;d.onclick=function(a){this.classList.contains("cur")?(this.className="btn",b.disableEdit(),ga("send",
"event","Track","Close")):(this.className+=" cur",b.enableEdit(),n?b.editor.continueForward():b.editor.continueBackward(),ga("send","event","Track","Open"))};b.editButton=d;h.on("editable:vertex:click",function(a){a.vertex.getIndex()===a.vertex.getLastIndex()?(n=!0,h.editTools.stopDrawing(),b.editor.continueForward(),a.cancel()):0===a.vertex.getIndex()&&(n=!1,h.editTools.stopDrawing(),b.editor.continueBackward(),a.cancel())});b.on("editable:editing",function(a){b.fire("v:change");ga("send","event",
"Track","Edit")}.throttle(300));b.on("v:change",function(e){a();d.group.classList.toggle("closed",b.isEmpty())});b.on("editable:vertex:rawclick",function(b){b.cancel()});b.on("editable:vertex:contextmenu",function(a){a.vertex.delete();h.editTools.stopDrawing();n?b.editor.continueForward():b.editor.continueBackward();h.fire("mousemove",a)});L.DomEvent.on(document,"keydown",function(a){27===a.keyCode&&b.editEnabled()&&(L.DomEvent.stop(a),b.editButton.click())}.bind(this))},function(a){a.classList.add("meter");
b.on("v:change",function(e){b.len=0;b.segs=[];e=b.getLatLngs();for(var d=1;d<e.length;d++){var f=e[d-1].toRad(),g=e[d].toRad(),c=O(f,g),l=B(f,g),h=B(g,f)+Math.PI;b.len+=c;b.segs.push({pA:f,pB:g,berA:l,berB:h,len:c,dlat:g.lat-f.lat,dlng:g.lng-f.lng,llOf:function(b){return N(this.pA,this.pB,b,this.len)}})}a.innerHTML=x(6371E3*b.len)+""}.throttle(200))},function(a){a.innerHTML='\ud83d\udcc2<input type="file" accept=".gpx,application/gpx+xml,.kml,application/vnd.google-earth.kml+xml">';a.classList.add("trkLoad");
a.title=i18n.btnTrackLoadTooltip;var e=a.querySelector("input[type=file]");a.onclick=function(b){e.click()};L.DomEvent.on(e,"change",function(d){if(e.files.length){var f=e.files[0];e.value="";if(!(2E6<f.size)||confirm(i18n.btnTrackLoadSizeWarn(f))){var g=new FileReader;g.readAsText(f);g.onload=function(){var e=(new DOMParser).parseFromString(g.result,"text/xml"),c=[];switch(e.documentElement.nodeName){case "gpx":for(var k=e.querySelector("trkpt")||e.querySelector("rtept");k;k=k.nextElementSibling)k.hasAttribute("lat")&&
k.hasAttribute("lon")&&c.push([parseFloat(k.getAttribute("lat")),parseFloat(k.getAttribute("lon"))]);break;case "kml":k=/([-+]?(?:\d*\.)\d+),([-+]?(?:\d*\.)\d+)(?:,[-+]?(?:\d*\.)\d+)?\b/g;for(var H=e.querySelector("LineString coordinates").textContent;e=k.exec(H);)c.push([parseFloat(e[2]),parseFloat(e[1])]);break;default:window.alert(i18n.btnTrackLoadInvalid(f));return}2>c.length?window.alert(i18n.btnTrackLoadEmpty(f)):(c=L.LineUtil.simplify(c.map(function(b){return L.point(b[0],b[1])}),1E-5).map(function(b){return L.latLng(b.x,
b.y)}),l=b.getLatLngs(),l.mapBounds=h.getBounds(),b.setLatLngs(c),b.fire("v:change",d),a.group.classList.add("canundo"),h.fitBounds(b.getBounds()),ga("send","event","Track","Import"))}}}})},function(a){a.innerHTML="\ud83d\udcbe";a.title=i18n.btnTrackGpxTooltip;a.onclick=function(a){var e='<?xml version="1.0" encoding="UTF-8"?>';e+='<gpx version="1.0" creator="https://'+i18n.domain+'/"  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.topografix.com/GPX/1/0" xsi:schemaLocation="http://www.topografix.com/GPX/1/0 http://www.topografix.com/GPX/1/0/gpx.xsd">';
e+="<rte>";b.getLatLngs().forEach(function(b){e+='<rtept lat="'+b.lat.toFixed(6)+'" lon="'+b.lng.toFixed(6)+'"></rtept>'});e+="</rte>";e+="</gpx>";a=window.document.createElement("a");a.href=window.URL.createObjectURL(new Blob([e],{type:"application/gpx+xml"}));a.download="route.gpx";document.body.appendChild(a);a.click();document.body.removeChild(a);ga("send","event","Track","Export")}},function(a){function e(a){var e=0,d=0;a=a.map(function(a,b){a=e+(e-d)+a;d=b?e:a;e=a;return a/10});a.step=6371E3*
b.len/(a.length-1);return a}function g(a){if(b.getLatLngs().length==b.segs.length+1&&(a=b.closestLayerPoint(a.layerPoint))&&!(200<a.distance)){a=h.layerPointToLatLng(a);for(var e=a.toRad(),d=0,f,c=0;c<b.segs.length;c++){var g=b.segs[c];if(g.pA.lat<e.lat==e.lat<g.pB.lat||g.pA.lng<e.lng==e.lng<g.pB.lng){var l=O(g.pA,e)/g.len;var k=g.dlat*e.lng-g.dlng*e.lat+g.pB.lng*g.pA.lat-g.pB.lat*g.pA.lng;k=k*k/(g.len*g.len);if(!f||k<f.err)f={err:k,pos:(p.length-1)*(d+l*g.len)/b.len,seg:g,i:c}}d+=g.len}f&&(G.setLatLng(a),
G.svgElem.transform.baseVal.getItem(0).setRotate(f.seg.berA/v,0,0),n(f.pos))}}function f(a,b){function e(){for(var a=f.hMax,b=f.hMin,e=a-b,d=$jscomp.makeIterator([1E3,500,250,100,50,25,10,5,2,1]),c=d.next();!c.done;c=d.next())if(c=c.value,e>2.2*c){b=Math.ceil((b+c/3)/c)*c;for(d=R.firstElementChild;R.children.length<e/c;)R.appendChild(d.cloneNode(!0));for(;d;)d.firstElementChild.textContent=x(b),e=-50,b<a-c/2&&(e=f.plot2wrap({x:0,y:b}).y),d.transform.baseVal.getItem(0).setTranslate(0,e),b+=c,d=d.nextElementSibling;
break}}if(p.length){var d=!0,g=p.length-1;if(0===a&&void 0===b)f._viewStart=0,f._viewWidth=g,w.classList.remove("zoomed"),d=!1;else if(1===b)f._viewStart=a,f._viewStart=Math.max(f._viewStart,0),f._viewStart=Math.min(f._viewStart,g-f._viewWidth),d=!1;else if("number"===typeof a&&"number"===typeof b){var c=f._viewWidth/b;c=Math.max(c,100);c=Math.min(c,g);c!=f._viewWidth&&(f._viewWidth=c,f._viewStart=(f._viewStart-a)/b+a,f._viewStart=Math.max(f._viewStart,0),f._viewStart=Math.min(f._viewStart,g-f._viewWidth),
w.classList.toggle("zoomed",f._viewWidth<g))}a=p[Math.floor(f._viewStart)];b=p[Math.floor(f._viewStart)];g=Math.floor(f._viewStart);for(c=Math.ceil(f._viewStart+f._viewWidth);g<=c;g++){var l=p[g];l<a&&(a=l);l>b&&(b=l)}b=Math.max(b,a+3);g=b-a;c={x:f._viewStart,y:a,width:f._viewWidth,height:g};c.x-=f._viewWidth/200;c.y-=g/10;c.width+=2*f._viewWidth/200;c.height+=2*g/10;J.x.baseVal.value=f._viewStart;J.width.baseVal.value=f._viewWidth;W.textContent=x(b);X.textContent=x(a);f.hMax=b;f.hMin=a;if(d){if(void 0===
f._animStart||!f._animTarget||f._animTarget.x!=c.x||f._animTarget.y!=c.y||f._animTarget.width!=c.width||f._animTarget.height!=c.height){f._animBase={};for(var h in c)f._animBase[h]=M.viewBox.baseVal[h];f._animTarget=c;void 0===f._animStart?(f._animStart=0,requestAnimationFrame(function V(a){var b=0;void 0===f._animStart?b=1:0==f._animStart?f._animStart=a:(b=(a-f._animStart)/f._animDur,1<b&&(b=1),M.viewBox.baseVal.x=f._animBase.x+b*(f._animTarget.x-f._animBase.x),M.viewBox.baseVal.y=f._animBase.y+
b*(f._animTarget.y-f._animBase.y),M.viewBox.baseVal.width=f._animBase.width+b*(f._animTarget.width-f._animBase.width),M.viewBox.baseVal.height=f._animBase.height+b*(f._animTarget.height-f._animBase.height),e());1>b?requestAnimationFrame(V):(f._animStart=void 0,f._animBase=void 0,f._animTarget=void 0)})):f._animStart=0}}else{f._animStart=void 0;for(var k in c)M.viewBox.baseVal[k]=c[k];e()}}}function k(a,e,d){e=K(e,0,p.length-1);d=K(d,0,p.length-1);if(e==d)a.setAttribute("d","");else{var c=1,g=(q(p,
e)+r.obsAh)/6371E3,l=(q(p,d)+r.obsBh)/6371E3;switch(r.rfrMode){case 1:c=1/r.rfrRadius;break;case 2:c=(g+l)/2;var h=r.rfrTemp+273+.0098*g,k=h-.0098*c;c=1-509539*(.0343-.0098)*Math.pow(1-.0098*c/h,3.5)/(k*k)}h=Math.abs(b.len*(d-e)/(p.length-1));l=(g+h*Math.sin(c*h/2)-l*Math.cos(c*h))/(h*Math.cos(c*h/2)+l*Math.sin(c*h));k="";for(var n=0;1.001>n;n+=.1){var A=h*n;A=(g-A*l*Math.cos(c*A/2)+A*Math.sin(c*A/2))/(l*Math.sin(c*A)+Math.cos(c*A));A=f.plot2wrap({x:q(e,d,n),y:6371E3*A});k+=" "+A.x+" "+A.y}a.setAttribute("d",
"M"+k)}}function n(a){if("number"===typeof a&&p.length){k(Y,0,a);k(Z,p.length-1,a);a=K(a,0,p.length-1.001);var b=Math.floor(a),e=a-b,d=q(p[b],p[b+1],e),c=f.plot2wrap({x:a,y:d}),g=p[b+1]-p[b],l=p.step;if(3<p.length){var h=0<b?p[b]-p[b-1]:g;b=p.length>b+2?p[b+2]-p[b+1]:g;g=(.5>e?h*(1-(e+.5))+g*(e+.5):g*(1-(e-.5))+b*(e-.5))/l}else g/=l;e=Math.atan(g);B.transform.baseVal.getItem(0).setRotate(-e/v,0,0);y.transform.baseVal.getItem(0).setTranslate(c.x,c.y);C.transform.baseVal.getItem(0).setTranslate(70<
c.x?c.x:Math.max(c.x,D.getComputedTextLength()+10),Math.max(c.y,45));D.textContent=x(d);N.textContent=Math.round(e/v)+"\u00b0";P.textContent=Math.round(100*g)+"%";Q.textContent=x(a*l);Q.setAttribute("x",c.x<w.clientWidth-70?c.x:Math.min(c.x,w.clientWidth-Q.getComputedTextLength()-10))}else y.transform.baseVal.getItem(0).setTranslate(0,0),D.textContent="",Q.textContent=""}var p=[],m,t,u=0,S=Promise.resolve();a.innerHTML="\ud83d\udcc8";a.title=i18n.btnTrackProfileTooltip;a.onclick=function(a){d(!d())};
var w=document.createElement("div");w.id="profile";w.innerHTML='<div class="error">'+i18n.btnTrackProfileUnavailable+'</div><svg width="100%" height="100%" viewBox="-50 -50 100 100" class="wait"><circle cx="-30" r="10" /><circle r="10" /><circle cx="30" r="10" /></svg><svg width="100%" height="100%" id="profile-svg"><use href="#profile-buttons" opacity="0.5" /><g id="profile-marks"><g transform="translate(0, 0)"><text fill="#999" font-size="12" x="3" y="-3"></text><line y1="0" x2="100%" y2="0" stroke="#ddd" /></g></g><g stroke="#ddd"><line y1="91.67%" x2="100%" y2="91.67%" /><line y1="8.33%" x2="100%" y2="8.33%" /></g><g fill="#999" font-size="12" transform="translate(3, -3)" id="profile-marks-text"><text y="8.33%" id="profile-text-hgtmax"></text><text y="91.67%" id="profile-text-hgtmin"></text></g><g transform="scale(1 -1)" transform-origin="center"><svg preserveAspectRatio="none" id="profile-plot-box" viewBox="0 0 1 1"><g  stroke-width="2"><path d="" stroke="#000" fill="none" id="profile-path" vector-effect="non-scaling-stroke"/></g></svg></g><g stroke="#777" transform="translate(0 0)" id="profile-crosshair"><line x1="-100%" y1="0" x2="100%" y2="0" /><line x1="0" y1="-100%" x2="0" y2="100%" /><line x1="-100" y1="0" x2="100" y2="0" transform="rotate(0)" id="profile-crosshair-angle" /></g><text y="-4" transform="translate(0 0)" font-size="13" text-anchor="end" id="profile-text-jumpy" style="stroke: white; stroke-width: 5; stroke-linejoin: bevel; paint-order: stroke fill;"><tspan x="-3" id="profile-text-height"></tspan><tspan x="-3" dy="-1em" id="profile-text-grade"></tspan><tspan x="-3" dy="-1em" id="profile-text-angle"></tspan></text><text dx="3" dy="-3" x="0" y="100%" font-size="13" id="profile-text-pos"></text><path d="" stroke="#777" fill="none" id="profile-sline-a"/><path d="" stroke="#777" fill="none" id="profile-sline-b"/><g id="profile-buttons-wrap" stroke="black"><svg x="100%" y="30" id="profile-buttons" overflow="visible"><g id="profile-btn-close" transform="translate(-30 0)"><title>'+
(i18n.profileBtnClose+'</title><circle r="17" /><text>\u274c</text></g><g id="profile-btn-export" transform="translate(-70 0)"><title></title><circle r="17" /><text>\ud83d\udcbe</text></g></svg></g></svg><svg width="99%" height="20%" id="profile-nav-svg"><g transform="scale(1 -1)" transform-origin="center"><svg preserveAspectRatio="none" id="profile-nav-box"><use href="#profile-path" /><rect x="0" y="0%" width="0" height="100%" fill="skyblue" opacity="0.5" id="profile-nav-slider" /></svg></g></svg>');
document.body.appendChild(w);var F=document.getElementById("profile-path"),M=document.getElementById("profile-plot-box"),I=document.getElementById("profile-svg"),z=document.getElementById("profile-nav-box"),J=document.getElementById("profile-nav-slider"),y=document.getElementById("profile-crosshair"),B=document.getElementById("profile-crosshair-angle"),C=document.getElementById("profile-text-jumpy"),D=document.getElementById("profile-text-height"),N=document.getElementById("profile-text-angle"),P=
document.getElementById("profile-text-grade"),Q=document.getElementById("profile-text-pos"),W=document.getElementById("profile-text-hgtmax"),X=document.getElementById("profile-text-hgtmin"),R=document.getElementById("profile-marks"),Y=document.getElementById("profile-sline-a"),Z=document.getElementById("profile-sline-b");document.getElementById("profile-btn-close").onclick=function(e){L.DomEvent.stop(e);d(!1);b.isTemporary&&(b.isTemporary=!1,a.group.classList.contains("canundo")&&!l.noAutoRestore?
(a.group.classList.remove("canundo"),b.setLatLngs(l)):b.setLatLngs([]),b.fire("v:change",e))};document.getElementById("profile-btn-export").onmouseenter=function(a){this.firstElementChild.textContent=i18n.profileBtnExport(Math.round(p.step))};document.getElementById("profile-btn-export").onclick=function T(a){L.DomEvent.stop(a);if(a.shiftKey){var d=window.prompt(i18n.profileExportStepPrompt,T.step||Math.round(p.step));if(null===d)return;d=d.replace(",",".");if(!/^(\d*\.)?\d+$/.test(d))return window.alert(i18n.errValueFormat);
d=+d;d<Math.round(p.step)&&(window.alert(i18n.warnProfileMinStep(Math.round(p.step))),d=void 0);T.step=d}Promise.resolve(d?fetch("/hgt/profile?path="+c(b.getLatLngs())+"&step="+d).then(function(a){if(!a.ok)throw a;return a.json()}).then(function(a){return e(a.hgt)}):p).then(function(a){var e=a.step,d=0,c=0,f=0,g=i18n.profileCsvHeader,l=b.segs[c];a.forEach(function(h,k){if(k){var n=a[k]-a[k-1];d+=Math.sqrt(e*e+n*n)}n=l.llOf(f/l.len).toDeg();g+=[Math.round(e*k),Math.round(d),h.toFixed(1).replace(".",
i18n.csvPt),n.lat.toFixed(5).replace(".",i18n.csvPt),n.lng.toFixed(5).replace(".",i18n.csvPt)].join(i18n.csvDelim)+"\r\n";for(f+=b.len/(a.length-1);f>l.len&&c<b.segs.length-1;)f-=l.len,c++,l=b.segs[c]});var h=window.document.createElement("a");h.href=window.URL.createObjectURL(new Blob([g],{type:"text/csv"}));h.download="profile.csv";document.body.appendChild(h);h.click();document.body.removeChild(h);ga("send","event","Profile","Export")}).catch(function(a){window.alert(i18n.errOpFailed)})};var G=
L.marker([0,0],{icon:L.divIcon({html:'<svg width="25" height="25"><g width="25" height="25" transform="rotate(0)" transform-origin="center" id="profile-track-marker"><path d="m16 12 8 4 0 -8z" fill="#0bd50b" stroke="#000" stroke-width="1.5"/><path d="m9 12 -8 4 0 -8z" fill="#f76e6e" stroke="#000" stroke-width="1.5"/></g></svg>',iconSize:[25,25],iconAnchor:[12,12],className:"vMark"}),interactive:!1});d=function(a){if(void 0===a)return!!d.state;a?(document.body.classList.add("profile"),d.state=!0,h.invalidateSize(!0),
b.fire("v:profile"),h.on("mousemove",g),G.addTo(h),G.svgElem=document.getElementById("profile-track-marker"),ga("send","event","Profile","Open")):(document.body.classList.remove("profile"),d.state=!1,h.invalidateSize(!0),h.off("mousemove",g),G.remove(),ga("send","event","Profile","Close"))};f.mouse=function(a){var b=I.createSVGPoint();b.x=a.clientX;b.y=a.clientY;return b.matrixTransform(F.getScreenCTM().inverse())};f.mouseNav=function(a){var b=I.createSVGPoint();b.x=a.clientX;b.y=a.clientY;return b.matrixTransform(J.getScreenCTM().inverse())};
f.plot2wrap=function(a){var b=I.createSVGPoint();b.x=a.x;b.y=a.y;return b.matrixTransform(I.getScreenCTM().inverse().multiply(F.getScreenCTM()))};f._viewStart=0;f._viewWidth=1;f._animStart=void 0;f._animDur=200;f._animBase=void 0;f._animTarget=void 0;L.DomEvent.on(I,"click",function(a){h.panTo(G.getLatLng())});L.DomEvent.on(I,"mousemove",function(a){a=f.mouse(a).x;n(a);for(var e=b.len*a/(p.length-1),d=0;d<b.segs.length;d++){a=b.segs[d];if(e<a.len||d==b.segs.length-1){e/=a.len;e=Math.max(0,e);e=Math.min(1,
e);G.setLatLng(a.llOf(e).toDeg());G.svgElem.transform.baseVal.getItem(0).setRotate(a.berA/v,0,0);break}e-=a.len}});L.DomEvent.on(I,"wheel",function(a){f(f.mouse(a).x,0>a.deltaY?1.5:2/3)});L.DomEvent.on(J,"mousedown",function(a){function b(a){L.DomEvent.stop(a);f(f.mouseNav(a).x-d,1)}function e(a){L.DomEvent.off(document,"mousemove",b);L.DomEvent.off(document,"mouseup wheel",e)}L.DomEvent.stop(a);var d=f.mouseNav(a).x-J.x.baseVal.value;L.DomEvent.on(document,"mousemove",b);L.DomEvent.on(document,"mouseup wheel",
e)});b.on("v:change",function(a){b.fire("v:profile",a)}.throttle(200));b.on("v:profile",function(a){if(d())if(2>b.getLatLngs().length)d(!1);else{u++;var g=u;S=S.then(function(){if(u!=g)throw null;clearTimeout(w.waitTimer);w.waitTimer=setTimeout(function(){w.classList.add("wait")},500);return fetch("/hgt/profile?path="+c(b.getLatLngs()))}).then(function(a){clearTimeout(w.waitTimer);w.classList.remove("wait");if(u!=g)throw null;if(!a.ok)throw a;return a.json()}).then(function(a){if(u!=g)throw null;
p=e(a.hgt);m=Math.min.apply(Math,$jscomp.arrayFromIterable(p));t=Math.max.apply(Math,$jscomp.arrayFromIterable(p));a=t-m;z.setAttribute("viewBox",[0,m-a/10,p.length-1,1.2*a]);J.y.baseVal.value=m-a/10;f.mouseNav.matrix=J.getScreenCTM().inverse();a=L.LineUtil.simplify(p.map(function(a,b){return L.point(b*p.step,a)}),.5);void 0===F.style.vectorEffect?(F.setAttribute("d","M"+a.map(function(a){return a.x/p.step+" "+a.y}).join(" ")+"V0H0z"),F.style.stroke="none",F.style.fill="black",F.style.opacity="0.2"):
F.setAttribute("d","M"+a.map(function(a){return a.x/p.step+" "+a.y}).join(" "));w.classList.remove("error");f(0)}).catch(function(a){null!==a&&w.classList.add("error")})}});h.on("v:profileit",function(e){var c=a.group.classList.contains("canundo");b.isEmpty()?a.group.classList.contains("canundo")&&(l.noAutoRestore=!0):b.isTemporary||(l=b.getLatLngs(),l.mapBounds=b.getBounds(),c=!0);b.setLatLngs(e.track);b.fire("v:change",e);d(!0);b.isTemporary=!0;c&&a.group.classList.add("canundo")});b.on("v:change",
function(a){b.isTemporary=!1})},function(a){a.innerHTML="\u2194\ufe0f";a.title=i18n.btnTrackReverseTooltip;a.onclick=function(a){b.getLatLngs().reverse();b.editEnabled()&&(h.editTools.stopDrawing(),n?b.editor.continueForward():b.editor.continueBackward());b.fire("v:change",a);ga("send","event","Track","Reverse")}},function(a){a.innerHTML="\u274c";a.title=i18n.btnTrackClearTooltip;a.onclick=function(e){b.editEnabled()&&b.editButton.click();l=b.getLatLngs();b.setLatLngs([]);b.fire("v:change",e);a.group.classList.add("canundo");
ga("send","event","Track","Clear")}},function(a){a.classList.add("undo");a.innerHTML="\u293a";a.title=i18n.btnTrackUndoTooltip;a.onclick=function(a){b.setLatLngs(l);b.fire("v:change",a);l.mapBounds&&h.fitBounds(l.mapBounds);ga("send","event","Track","Restore")};b.on("v:change",function(e){b.isEmpty()||a.group.classList.remove("canundo")})}]}).addTo(h);u.push(function(){return b.getLatLngs().length?"!"+c(b.getLatLngs())+"!"+(d()?"p":"")+"t":""});y.push(function(a){(a=a.match(/[#,]!([?-~0-9]+)!(p?)t(?=,|$)/))?
(b.setLatLngs(k(a[1])),d(!!a[2])):(b.setLatLngs([]),d(!1));b.fire("v:change")})})();(function(){function d(){c&&fetch("https://api.flickr.com/services/rest/?api_key=b6d2535aa43c442286c4079f78c0aeda&method=flickr.photos.search&bbox="+h.getBounds().toBBoxString()+"&media=photos&content_type=1&per_page=128&extras=geo,owner_name,o_dims,url_sq,url_z&sort=relevance&text=landscape&format=json&nojsoncallback=1").then(function(a){return a.json()}).then(b)}function b(a){a=a&&"ok"==a.stat&&a.photos&&a.photos.photo||
[];var b=h.getBounds(),d=65*((b.getEast()-b.getWest()+360)%360||360)/h.getSize().x;b=65*(b.getNorth()-b.getSouth())/h.getSize().y;for(var c={},f=[],l=0;l<a.length;l++){a[l].latitude=parseFloat(a[l].latitude);a[l].longitude=parseFloat(a[l].longitude);for(var n=0,m=-1,q=128;0<q;q>>=1){var r=n|q;r<f.length&&f[r].longitude<a[l].longitude-d&&(n=r)}for(;n<f.length&&f[n].longitude<a[l].longitude+d;){if(Math.abs(f[n].latitude-a[l].latitude)<b){m=null;break}f[n].longitude<a[l].longitude&&(m=n);n++}null!==
m&&(f.splice(m+1,0,a[l]),H[a[l].id]?c[a[l].id]=H[a[l].id]:(n=L.marker([a[l].latitude,a[l].longitude],{title:a[l].title,keyboard:!1,pane:"vPhotos",icon:L.icon({iconUrl:a[l].url_sq,iconSize:[75,75],iconAnchor:[37,37]})}).addTo(h),n.photo=a[l],n.on("click",function(){var a=this.photo;g=a.id;k.setContent(['<p><a href="https://www.flickr.com/photos/'+a.owner+"/"+a.id+'" target="_blank">','<img src="'+a.url_z+'" width="'+a.width_z+'" height="'+a.height_z+'">',"</a></p><p>",i18n.flickrAuthor,' <a target="_blank" href="https://www.flickr.com/photos/'+
a.owner+'/">',a.ownername,"</a></p>"].join(""));k.setLatLng(this.getLatLng());k.openOn(h);e=null;ga("send","event","Flickr","Click","",a.id)}),c[a[l].id]=n,a[l].id==e&&n.fire("click")))}for(var t in H)c[t]||H[t].remove();H=c}var c=!1,k=L.popup({maxWidth:680});k.on({add:a,remove:a});h.createPane("vPhotos");var g,e,H={},f=L.DomUtil.create("div","btnGroup closed"),m=L.DomUtil.create("div","btn");m.innerHTML=i18n.btnFlickrText;m.onclick=function(e){this.classList.contains("cur")?(this.className="btn",
c=!1,b(!1),ga("send","event","Flickr","Off")):(this.className+=" cur",c=!0,d(),ga("send","event","Flickr","On"));a()};f.appendChild(m);(new (L.Control.extend({onAdd:function(a){L.DomEvent.disableClickPropagation(f);return f}}))({position:"topleft"})).addTo(h);u.push(function(){return c?(k.isOpen()?encodeURIComponent(g):"")+"p":""});y.push(function(a){(a=a.match(/[#,]([^,]*)p(?=,|$)/))?(a[1]&&(e=a[1]),c=!0,m.className="btn cur",d()):(c=!1,m.className="btn",b(!1))});h.on("moveend",d.debounce(300))})();
(function(){function d(){if(h.hasLayer(c)){var e=c.getLatLng(),g=(100+Math.abs(e.lat)).toFixed(4).slice(1),f=(1E3+Math.abs(e.lng)).toFixed(4).slice(1);g=(0>e.lat?"-":"+")+g;f=(0>e.lng?"-":"+")+f;var l=r.maxRng?",xr":"",n=(1==r.rfrMode?r.rfrRadius.toFixed(2):r.rfrTemp)+"rp",m="/vshed/"+g+","+f+","+r.obsAh+"ah,"+r.obsBh+"bh"+l+(r.rfrMode?","+r.rfrMode+"rm,"+n:"")+"/layout.json";d.iqp&&void 0!==d.iqp[m]||(d.iqp={},c.fire("v:progress",{p:1}));clearTimeout(d.Tretry);fetch(m+"?z="+h.getZoom()).then(function(a){if(!a.ok)throw a;
return a.json()}).then(function(a){a.qp?(d.iqp[m]=a.qp<d.iqp[m]?d.iqp[m]:a.qp,c.fire("v:progress",{p:a.qp/(d.iqp[m]+1)}),d.Tretry=setTimeout(d,1E3)):(b&&b.remove(),b=(new k("/vshed/"+a.tpth+"/z{z}/{x}/{y}.png",{maxNativeZoom:a.zlim,opacity:.5,zIndex:3,tileMaps:a.tmap.map(atob),zoomRects:a.zrct})).addTo(h),b.Tkeep=setInterval(function(){fetch(m+"?keep")},6E4),c.fire("v:progress",{p:0}),document.body.classList.add("viewshed"),b.on("remove",function(){document.body.classList.remove("viewshed");clearInterval(b.Tkeep)}),
ga("send","event","Viewshed","New"),7>h.getZoom()&&h.setView(e,7),h.getZoom()>a.zlim+4&&h.setZoom(a.zlim+4))}).catch(function(a){400==a.status?window.alert(i18n.errOpFailed):window.alert(i18n.errTmpUnavail);c.remove();b&&b.remove()}).finally(function(){});h.fire("v:infow-invalidate");a()}}var b=null,c=L.marker([0,0],{draggable:!0,icon:L.divIcon({html:'<svg width="23" height="40" id="vshMarker"><path d="M4.1 20.73C-.59 13.76.68 1.89 11.5 1.89s12.08 11.86 7.4 18.84c-3.61 5.4-7.4 12.16-7.4 19.27 0-7.12-3.79-13.87-7.4-19.27z" fill="#550a0a" stroke="#000" stroke-linejoin="bevel" stroke-width="1.5"/><circle cx="11.5" cy="11.93" r="9.43" fill="url(#vshigrd)" stroke="#000" stroke-width=".67"/><circle cx="11.5" cy="11.93" r="8.49" fill="none" stroke="#ff9c00" stroke-width="1.35"/><g class="loaded"><path d="M11.5 11.93L3.44 7.96 4.6 6.2zl-3.97 8.06-1.76-1.15zl8.53-2.83.4 2.06z" fill="#f60"/><ellipse cx="11.5" cy="11.93" rx="1.41" ry="5.98" stroke="#ffd200"/></g><g class="loading"><circle r="4.71" fill="none" stroke="#550a0a" stroke-width="9.43" transform="translate(11.5 11.93) scale(-1 1) rotate(-90)" stroke-dasharray="9 30"/></g></svg>',
iconSize:[23,40],iconAnchor:[11,39],className:"vMark"})}).on({dragend:d,"v:progress":function(a){a=a.p;this._icon.querySelector("svg#vshMarker").classList.toggle("loaded",0==a);this._icon.querySelector("g.loading circle").setAttribute("stroke-dasharray",30*a+" 30")},click:function(a){h.fire("click",a)}});L.control.btnGroup({position:"topleft",id:"vshGroup",buttons:[function(a){a.innerHTML='<svg width="19" height="19" style="width: 19px; margin: -1px; vertical-align: top;"><defs><radialGradient id="vshigrd"><stop offset="0"/><stop stop-color="#e82100" offset="1"/></radialGradient></defs><circle cx="9.5" cy="9.5" fill="url(#vshigrd)" stroke="#000" stroke-width=".66" r="9.17"/><circle cx="9.5" cy="9.5" fill="none" stroke="#ff9c00" stroke-width="1.31" r="8.25"/><path d="M9.5 9.5L1.66 5.64l1.11-1.7zM9.5 9.5l-3.86 7.84-1.7-1.11zM9.5 9.5l8.3-2.74.4 1.99z" fill="#f60"/><ellipse cx="9.5" cy="9.5" rx="1.37" ry="5.82" stroke="#ffd200"/></svg>';
a.title=i18n.btnViewshedTooltip;a.onmousedown=function(a){h.tglvMode("vshmark")}},function(a){a.classList.add("settings");a.innerHTML="\u2699\ufe0f";a.title=i18n.btnViewshedSettingsTooltip;a.onclick=function(b){a.group.q("cfgw").classList.toggle("show")}},function(b){b.classList.add("cfgw");b.dataset.key="cfgw";b.innerHTML="<p>"+i18n.vshCfgObsA+'<br><input type="number" data-key="obsAh" min="0" max="10000" value="2">'+i18n.meterSuffix+"</p><p>"+(i18n.vshCfgObsB+'<br><input type="number" data-key="obsBh" min="0" max="10000" value="0">'+
i18n.meterSuffix+"</p><hr><p><label>")+(i18n.vshCfgMaxRes+' <input type="radio" name="vshRng" data-key="rngN" checked></label></p><p><label>')+(i18n.vshCfgMaxRng+' <input type="radio" name="vshRng" data-key="rngL"></label></p><hr><p><label title="')+(i18n.vshCfgRfrNTooltip+'">'+i18n.vshCfgRfrN+' <input type="radio" name="vshRfr" value="0" data-key="rfrN" checked></label></p><p><label title="')+(i18n.vshCfgRfrRTooltip+'">'+i18n.vshCfgRfrR+' <input type="radio" name="vshRfr" value="1" data-key="rfrR" ></label><br><input type="number" data-key="rfrRv" min="0.5" max="10000" value="1.33" step="0.01"> R</p><p><label title="')+
(i18n.vshCfgRfrTTooltip+'">'+i18n.vshCfgRfrT+' <input type="radio" name="vshRfr" value="2" data-key="rfrT"></label><br><input type="number" data-key="rfrTv" min="-100" max="100" value="15"> \u00b0C</p>');L.DomEvent.on(b,"input",function(c){c=$jscomp.makeIterator(b.querySelectorAll("input[type=number]"));for(var e=c.next();!e.done;e=c.next())e=e.value,""!==e.min&&parseFloat(e.value)<parseFloat(e.min)&&(e.value=e.min),""!==e.max&&parseFloat(e.value)>parseFloat(e.max)&&(e.value=e.max);r.obsAh=parseInt(b.q("obsAh").value,
10)||0;r.obsBh=parseInt(b.q("obsBh").value,10)||0;r.maxRng=b.q("rngL").checked;r.rfrMode=+b.querySelector('input[name="vshRfr"]:checked').value;r.rfrRadius=parseFloat(b.q("rfrRv").value)||0;r.rfrTemp=parseInt(b.q("rfrTv").value,10);d();a()}.debounce(1E3));h.on("v:settings",function(){b.q("obsAh").value=r.obsAh;b.q("obsBh").value=r.obsBh;b.q("rngN").checked=!r.maxRng;b.q("rngL").checked=r.maxRng;b.q("rfrN").checked=!r.rfrMode;b.q("rfrR").checked=1==r.rfrMode;b.q("rfrT").checked=2==r.rfrMode;b.q("rfrRv").value=
r.rfrRadius;b.q("rfrTv").value=r.rfrTemp})},function(e){e.classList.add("clear");e.innerHTML="\u274c";e.title=i18n.btnViewshedClearTooltip;e.onclick=function(e){"vshmark"==h.vMode&&h.setvMode(!1);c.remove();b&&b.remove();document.body.classList.remove("viewshed");h.fire("v:infow-invalidate");a()}}]}).addTo(h).getContainer();var k=L.TileLayer.extend({getTileUrl:function(a){var b=this.options.zoomRects[a.z],c=(1<<a.z)-1;return a.y<b.P.Y||a.y>=b.Q.Y||a.x<b.P.X!=a.x>=b.Q.X==b.P.X<b.Q.X||7<a.z&&(b=(a.y-
b.P.Y)*(b.Q.X-b.P.X&c)+(a.x-b.P.X&c),0==(this.options.tileMaps[a.z-8].charCodeAt(b>>3)&1<<(b&7)))?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII=":L.TileLayer.prototype.getTileUrl.call(this,a)}});C.push(function(b){if("vshmark"==h.vMode)return c.setLatLng(b.latlng),c.addTo(h),d(),h.setvMode(!1),a(),!0});var g={miUpdate:function(b,g){c.setLatLng(b);c.addTo(h);d();a()},miLookBack:function(b,g){h.hasLayer(c)&&(g=c.getLatLng(),c.setLatLng(b),
d(),h.panTo(g),a())},miProfile:function(a,b){if(h.hasLayer(c)){var d=c.getLatLng();b.track=[d,a];h.fire("v:profileit",b);h.fire("v:infow-invalidate")}}};h.on("v:infow",function(a){var b=a.ll,d=a.popup;a=a.popwrap;var e=c.getLatLng();a.q("menu").insertAdjacentHTML("beforeend",'<li data-key="miUpdate">'+i18n.vshMenuLookFromHere+"</li>");h.hasLayer(c)&&(a.q("data").insertAdjacentHTML("beforeend",i18n.iWdistance+": <b>"+x(h.distance(e,b))+"</b><br/>"+(i18n.iWaz+": <b>"+Math.round((B(e.toRad(),b.toRad())/
v+360)%360)+"\u00b0\u00a0/\u00a0"+Math.round((B(b.toRad(),e.toRad())/v+360)%360)+"\u00b0</b><br/>")),a.q("menu").insertAdjacentHTML("beforeend",'<li data-key="miLookBack">'+i18n.vshMenuLookBack+'</li><li data-key="miProfile">'+(i18n.vshMenuProfile+"</li>")));a.qev("click",g,b);d.update()});u.push(function(){return h.hasLayer(c)?c.getLatLng().toUrlValue()+"y":""});y.push(function(a){(a=a.match(/[#,](-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?)y(?=,|$)/))?(c.setLatLng([parseFloat(a[1]),parseFloat(a[2])]),c.addTo(h),
d()):(c.remove(),b&&b.remove(),document.body.classList.remove("viewshed"))})})();(function(){function d(c){var d=b.indexOf(null);0>d&&(d=b.length);25<d||(b[d]=L.marker(c,{draggable:!0,pane:"vMarkers",icon:L.divIcon({html:'<svg width="23" height="40"><path d="M4.1 20.73C-.59 13.76.68.75 11.5.75s12.08 13 7.4 19.98c-3.61 5.4-7.4 12.16-7.4 19.27 0-7.12-3.79-13.87-7.4-19.27z" fill="#e77" stroke="#000" stroke-linejoin="bevel" stroke-width="1.5"/><text x="11.5" y="17.36" font-family="sans-serif" font-size="16" text-anchor="middle">'+
String.fromCharCode(65+d)+"</text></svg>",iconSize:[23,40],iconAnchor:[11,39],className:"vMark"})}).on({contextmenu:function(c){c=d;b[c].remove();for(b[c]=null;!b[b.length-1]&&b.length;)b.length--;a()},dragend:a}).addTo(h))}var b=[];h.createPane("vMarkers");L.DomEvent.on(document,"keydown",function(a){77==a.keyCode&&(h.tglvMode("mark"),L.DomEvent.stop(a))}.bind(this));C.push(function(b){if("mark"==h.vMode)return d(b.latlng),a(),!0});u.push(function(){return b.length?"!"+c(b.filter(Boolean).map(function(a){return a.getLatLng()}))+
"!"+t(b.reduce(function(a,b,c){return a|(b?0:1<<c)},0))+"m":""});y.push(function(a){b.forEach(function(a){a&&a.remove()});b=[];if(a=a.match(/[#,]!([?-~0-9]+)!([a-zA-Z]*)m(?=,|$)/)){var c=m(a[2]);k(a[1]).forEach(function(a){for(;c&1<<b.length;)b[b.length]=!1;d(a)});b=b.map(function(a){return a?a:null})}})})();(function(){if(i18n.forumDomain){h.createPane("vTopics");var a=fetch("https://"+i18n.forumDomain+"/mapdata.php").then(function(a){return a.json()});a.then(function(a){a.forEach(function(a){L.marker(a.p,
{pane:"vTopics",icon:L.divIcon({html:'<svg width="32" height="32"><ellipse cx="16" cy="15.5" rx="11.5" ry="9" fill="#fff" stroke="#000"/><path d="M7.33 20.86L5.5 25.5l5.77-2.27" fill="#fff" stroke="#000"/></svg>',iconSize:[32,32],iconAnchor:[5,25],className:"vTopic"}),title:a.tt,opacity:a.n?.3:1}).addTo(h).on("click",function(a){a.noRecurse=!0;h.fire("click",a)})});return a});h.on("v:infow",function(b){var c=b.ll,d=b.popup,g=b.popwrap;a.then(function(a){g.q("links").insertAdjacentHTML("beforeend",
'<a id="forumlink" target="_blank" href="//'+i18n.forumDomain+"/loctopic.php?lat="+c.lat.toFixed(6)+"&lon="+c.lng.toFixed(6)+'">'+i18n.forumDiscuss+"</a>");var b=g.querySelector("#forumlink");a.forEach(function(a){400>L.latLng(a.p).distanceTo(c)&&(b.href="//"+i18n.forumDomain+"/viewtopic.php?t="+a.t,a.tt.indexOf("\u00b0")+1?b.textContent=i18n.forumTopic:(b.textContent=a.tt,b.title=i18n.forumTopic))});d.update()})})}})();window.onhashchange()})();
